<UserControl x:Class="MaritimeERP.Desktop.Views.UserManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Grid.ColumnSpan="2" Background="#1976D2" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ‘¥" FontSize="24" VerticalAlignment="Center" Foreground="White"/>
                    <TextBlock Text="User Management" FontSize="20" FontWeight="SemiBold" 
                               Foreground="White" Margin="12,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
                
                <Button Grid.Column="1" Content="Refresh" 
                        Command="{Binding LoadDataCommand}"
                        Background="#0D47A1" Foreground="White" 
                        BorderThickness="0" Padding="16,8" 
                        FontWeight="Medium"/>
            </Grid>
        </Border>

        <!-- Statistics Cards -->
        <Border Grid.Row="1" Grid.ColumnSpan="2" Background="#F5F5F5" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Users -->
                <Border Grid.Column="0" Background="White" CornerRadius="8" Margin="0,0,8,0" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding TotalUsers}" FontSize="28" FontWeight="Bold" Foreground="#1976D2" HorizontalAlignment="Center"/>
                        <TextBlock Text="Total Users" FontSize="12" Foreground="#757575" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Active Users -->
                <Border Grid.Column="1" Background="White" CornerRadius="8" Margin="4,0" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding ActiveUsers}" FontSize="28" FontWeight="Bold" Foreground="#388E3C" HorizontalAlignment="Center"/>
                        <TextBlock Text="Active" FontSize="12" Foreground="#757575" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Inactive Users -->
                <Border Grid.Column="2" Background="White" CornerRadius="8" Margin="4,0" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding InactiveUsers}" FontSize="28" FontWeight="Bold" Foreground="#D32F2F" HorizontalAlignment="Center"/>
                        <TextBlock Text="Inactive" FontSize="12" Foreground="#757575" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Status -->
                <Border Grid.Column="3" Background="White" CornerRadius="8" Margin="8,0,0,0" Padding="16">
                    <Border.Effect>
                        <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="{Binding StatusMessage}" FontSize="12" Foreground="#757575" HorizontalAlignment="Center" TextWrapping="Wrap"/>
                        <ProgressBar IsIndeterminate="{Binding IsLoading}" Height="4" Margin="0,8,0,0" 
                                     Background="#E0E0E0" Foreground="#1976D2"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- Users List -->
        <Border Grid.Row="2" Grid.Column="0" Background="White" Margin="16,8,8,16" CornerRadius="8">
            <Border.Effect>
                <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- List Header -->
                <Border Grid.Row="0" Background="#F8F9FA" Padding="16,12" CornerRadius="8,8,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" Text="Users" FontSize="16" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Content="Add User" Command="{Binding AddUserCommand}"
                                    Background="#1976D2" Foreground="White" BorderThickness="0"
                                    Padding="12,6" Margin="0,0,8,0" FontWeight="Medium"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Users DataGrid -->
                <DataGrid Grid.Row="1" ItemsSource="{Binding Users}" SelectedItem="{Binding SelectedUser}"
                          AutoGenerateColumns="False" CanUserAddRows="False" 
                          GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                          Background="White" BorderThickness="0" Margin="1">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="120"/>
                        <DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="180"/>
                        <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="200"/>
                        <DataGridTextColumn Header="Role" Binding="{Binding Role.Name}" Width="100"/>
                        <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="70"/>
                        <DataGridTextColumn Header="Last Login" Binding="{Binding LastLoginDisplay}" Width="140"/>
                        <DataGridTextColumn Header="Created" Binding="{Binding CreatedAtDisplay}" Width="100"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Action Buttons -->
                <Border Grid.Row="2" Background="#F8F9FA" Padding="16,8" CornerRadius="0,0,8,8">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="Edit" Command="{Binding EditUserCommand}"
                                Background="#FFA726" Foreground="White" BorderThickness="0"
                                Padding="12,6" Margin="0,0,8,0" FontWeight="Medium"/>
                        <Button Content="Delete" Command="{Binding DeleteUserCommand}"
                                Background="#E53935" Foreground="White" BorderThickness="0"
                                Padding="12,6" Margin="0,0,8,0" FontWeight="Medium"/>
                        <Button Content="Activate" Command="{Binding ActivateUserCommand}"
                                Background="#43A047" Foreground="White" BorderThickness="0"
                                Padding="12,6" Margin="0,0,8,0" FontWeight="Medium"/>
                        <Button Content="Deactivate" Command="{Binding DeactivateUserCommand}"
                                Background="#FB8C00" Foreground="White" BorderThickness="0"
                                Padding="12,6" Margin="0,0,8,0" FontWeight="Medium"/>
                        <Button Content="Reset Password" Command="{Binding ResetPasswordCommand}"
                                Background="#8E24AA" Foreground="White" BorderThickness="0"
                                Padding="12,6" FontWeight="Medium"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <!-- User Form -->
        <Border Grid.Row="2" Grid.Column="1" Background="White" Margin="8,8,16,16" CornerRadius="8">
            <Border.Effect>
                <DropShadowEffect Color="Gray" Direction="270" ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
            </Border.Effect>
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid Margin="16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Form Header -->
                    <TextBlock Grid.Row="0" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,16">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Text" Value="User Details"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                        <Setter Property="Text" Value="Edit User"/>
                                    </DataTrigger>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding IsEditing}" Value="True"/>
                                            <Condition Binding="{Binding SelectedUser}" Value="{x:Null}"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Text" Value="Add New User"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>

                    <!-- Form Fields -->
                    <StackPanel Grid.Row="1" IsEnabled="{Binding IsEditing}">
                        <!-- Username -->
                        <Label Content="Username:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="32" Padding="8,6" BorderBrush="#BDBDBD"/>

                        <!-- Full Name -->
                        <Label Content="Full Name:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <TextBox Text="{Binding FullName, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="32" Padding="8,6" BorderBrush="#BDBDBD"/>

                        <!-- Email -->
                        <Label Content="Email:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="32" Padding="8,6" BorderBrush="#BDBDBD"/>

                        <!-- Role -->
                        <Label Content="Role:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <ComboBox ItemsSource="{Binding Roles}" SelectedItem="{Binding SelectedRole}"
                                  DisplayMemberPath="Name" Height="32" Padding="8,6" BorderBrush="#BDBDBD"/>

                        <!-- Password (only for new users or when editing) -->
                        <Label Content="Password:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <PasswordBox x:Name="PasswordField"
                                     Height="32" Padding="8,6" BorderBrush="#BDBDBD"
                                     ToolTip="Enter new password (minimum 8 characters) or leave empty to keep current password"/>

                        <!-- Confirm Password -->
                        <Label Content="Confirm Password:" FontWeight="Medium" Margin="0,8,0,4"/>
                        <PasswordBox x:Name="ConfirmPasswordField"
                                     Height="32" Padding="8,6" BorderBrush="#BDBDBD"
                                     ToolTip="Confirm the new password"/>
                        
                        <!-- Password Validation Message -->
                        <TextBlock x:Name="PasswordValidationMessage"
                                   FontSize="12" Foreground="Red" Margin="0,4,0,0" 
                                   TextWrapping="Wrap" Visibility="Collapsed"
                                   Text="Passwords do not match"/>

                        <!-- Active Status -->
                        <CheckBox Content="Active" IsChecked="{Binding IsActive}" Margin="0,16,0,8" FontWeight="Medium"/>

                        <!-- Form Note -->
                        <TextBlock FontSize="12" Foreground="#757575" Margin="0,8,0,0" TextWrapping="Wrap">
                            <TextBlock.Text>
                                <Binding Path="SelectedUser">
                                    <Binding.TargetNullValue>Password is required for new users (minimum 8 characters)</Binding.TargetNullValue>
                                    <Binding.FallbackValue>For existing users: Leave password fields empty to keep current password, or enter new password to change it. You can also use "Reset Password" button for quick password reset.</Binding.FallbackValue>
                                </Binding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>

                    <!-- Form Buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
                        <Button Content="Save" Command="{Binding SaveUserCommand}"
                                Background="#1976D2" Foreground="White" BorderThickness="0"
                                Padding="16,8" Margin="0,0,8,0" FontWeight="Medium"
                                Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <Button Content="Cancel" Command="{Binding CancelEditCommand}"
                                Background="#757575" Foreground="White" BorderThickness="0"
                                Padding="16,8" FontWeight="Medium"
                                Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl> 